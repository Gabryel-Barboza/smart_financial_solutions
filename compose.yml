services:
  # FastAPI porta 8000, volume embeddings_cache
  fastapi:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - 8000:8000
    networks:
      - mainnet
    volumes:
      - embeddings_cache:/app/fastembed_cache/
    env_file:
      - .env
    restart: always

  # Frontend nginx porta 8080, argumento obrigat√≥rio VITE_FASTAPI_URL
  frontend:
    depends_on: 
      - fastapi
      - qdrant
    build:
      context: .
      dockerfile: Dockerfile.frontend
      args:
        VITE_FASTAPI_URL: http://localhost:8000/api
    ports:
      - 8080:80
    networks:
      - mainnet
    restart: always

  # Qdrant Vector Store porta 6333, volume qdrant_data
  qdrant:
    image: qdrant/qdrant
    env_file:
      - .env
    ports:
      - 6333:6333
    networks:
      - mainnet
    volumes:
      - qdrant_data:/qdrant/storage:z
    restart: always

volumes:
    qdrant_data:
    embeddings_cache:

networks:
  mainnet:
